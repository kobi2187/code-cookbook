<!DOCTYPE html>
<html lang="en" id="page">  <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width"/><title>Strict typing for stringly-typed extern code  - Haxe Code Cookbook</title><base href="./../.."/>
<link rel="stylesheet" type="text/css" href="http://haxe.org/css/bootstrap.min.css"/><link rel="stylesheet" type="text/css" href="css/styles.min.css"/><link rel="icon" href="http://haxe.org/favicon.ico"/><meta name="keywords" content="abstract-type,type-params,extern,haxe,code,tutorial,snippet,example,demo"/><meta name="description" content="A common pattern, often found in (but not only in) dynamic languages, is to denote the type of some object
with a string, for example:"/>
<meta name="twitter:creator" content="@haxe_org"/>
<meta property="og:title" content="Strict typing for stringly-typed extern code  - Haxe Code Cookbook"/><meta property="og:type" content="article"/><meta property="og:url" content="http://code.haxe.org/"/><meta property="og:image" content="http://code.haxe.org/img/share.png"/><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,700italic,400italic" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400" rel="stylesheet" type="text/css"/>  </head><body><nav class="section nav dark"><div class="navbar navbar-fixed-top navbar-inverse"><div class="navbar-inner"><button class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse" type="button"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="brand haxe-logo" href="http://haxe.org/"><img alt="Haxe" height="21" onerror="this.src='http://haxe.org/img/haxe-logo-horizontal-on-dark.png'" src="http://haxe.org/img/haxe-logo-horizontal-on-dark.svg" width="107"/></a><a class="brand sub ide" href="./">CODE</a><div class="nav-collapse collapse"><ul class="nav">
<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-book"></i> Browse <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="category/beginner/">Beginner <small class="category-count">(5)</small></a></li><li><a href="category/compilation/">Compilation <small class="category-count">(1)</small></a></li><li><a href="category/data-structures/">Data structures <small class="category-count">(4)</small></a></li><li><a href="category/macros/">Macros <small class="category-count">(15)</small></a></li><li><a href="category/other/">Other <small class="category-count">(5)</small></a></li><li class="active"><a href="category/abstract-types/">Abstract types <small class="category-count">(4)</small></a></li><li><a href="category/design-patterns/">Design-patterns <small class="category-count">(3)</small></a></li><li><a href="category/principles/">Principles <small class="category-count">(3)</small></a></li></ul></li><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-tags"></i> Tags <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="tag/abstract-type.html" rel="tag"><i class="fa fa-tag"></i> abstract-type <small class="category-count">(5)</small></a></li><li><a href="tag/macro-function.html" rel="tag"><i class="fa fa-tag"></i> macro-function <small class="category-count">(9)</small></a></li><li><a href="tag/iterator.html" rel="tag"><i class="fa fa-tag"></i> iterator <small class="category-count">(3)</small></a></li><li><a href="tag/javascript.html" rel="tag"><i class="fa fa-tag"></i> javascript <small class="category-count">(2)</small></a></li><li><a href="tag/pattern-matching.html" rel="tag"><i class="fa fa-tag"></i> pattern-matching <small class="category-count">(2)</small></a></li><li><a href="tag/enum.html" rel="tag"><i class="fa fa-tag"></i> enum <small class="category-count">(3)</small></a></li><li><a href="tag/class.html" rel="tag"><i class="fa fa-tag"></i> class <small class="category-count">(3)</small></a></li><li><a href="tag/arguments.html" rel="tag"><i class="fa fa-tag"></i> arguments <small class="category-count">(2)</small></a></li><li><a href="tag/validation.html" rel="tag"><i class="fa fa-tag"></i> validation <small class="category-count">(3)</small></a></li><li><a href="tag/conditional-compilation.html" rel="tag"><i class="fa fa-tag"></i> conditional-compilation <small class="category-count">(2)</small></a></li><li><a href="tag/building-fields.html" rel="tag"><i class="fa fa-tag"></i> building-fields <small class="category-count">(6)</small></a></li><li><a href="tag/build-macro.html" rel="tag"><i class="fa fa-tag"></i> build-macro <small class="category-count">(6)</small></a></li><li><a href="tag/libraries.html" rel="tag"><i class="fa fa-tag"></i> libraries <small class="category-count">(2)</small></a></li><li><a href="tag/static-extension.html" rel="tag"><i class="fa fa-tag"></i> static-extension <small class="category-count">(2)</small></a></li><li><a href="tag/dead-code-elimination.html" rel="tag"><i class="fa fa-tag"></i> dead-code-elimination <small class="category-count">(2)</small></a></li></ul></li><li class="divider"></li>
<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="/documentation/">Learn Haxe <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="http://haxe.org/documentation/">Introduction</a></li><li class="divider"></li><li><a href="http://haxe.org/manual/">Manual</a></li><li><a href="http://api.haxe.org">API Documentation</a></li><li class="divider"></li><li><a href="http://try.haxe.org">Try Haxe</a></li><li><a href="http://lib.haxe.org">Haxelib</a></li><li class="active"><a href="http://code.haxe.org">Code Cookbook</a></li></ul></li><li class=" dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Connect <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://github.com/HaxeFoundation"><i class="fa fa-github"></i> Github</a></li><li><a href="https://github.com/HaxeFoundation/haxe/issues"><i class="fa fa-github"></i> Bug reports</a></li><li><a href="http://stackoverflow.com/questions/tagged/haxe"><i class="fa fa-stack-exchange"></i> Stack Overflow</a></li><li><a href="http://groups.google.com/group/haxelang?hl=en"><i class="fa fa-envelope-o"></i> Google Groups</a></li><li><a href="http://webchat.freenode.net/?channels=haxe"><i class="fa fa-comments-o"></i> IRC</a></li><li><a href="http://haxe.org/blog"><i class="fa fa-rss"></i> Blog</a></li><li class="divider"></li><li><a href="https://plus.google.com/communities/103302587329918132234"><i class="fa fa-google-plus"></i> Google+</a></li><li><a href="https://www.facebook.com/haxe.org/"><i class="fa fa-facebook"></i> Facebook</a></li><li><a href="https://twitter.com/search?q=%23haxe"><i class="fa fa-twitter"></i> #haxe</a></li><li><a href="https://twitter.com/haxelang"><i class="fa fa-twitter"></i> @haxelang</a></li><li><a href="https://twitter.com/haxe_org"><i class="fa fa-twitter"></i> @haxe_org</a></li><li class="divider"></li><li><a href="http://haxe.org/foundation/contact.html">Contact</a></li></ul></li></ul></div></div></div></nav><div class="main-content"><header class="hero-unit-small"><div class="container"><div class="row"><h1>Haxe Code Cookbook</h1></div></div></header><main class="container"><section class="row"><nav class="span4 sidebar-toc" id="sidebar"><h3>Table of contents</h3><ul class="unstyled"><li><a href="category/beginner/">Beginner</a><ul class="unstyled"><li><a href="category/beginner/conditional-compilation.html">Conditional compilation</a></li><li><a href="category/beginner/declare-classes.html">Declare classes</a></li><li><a href="category/beginner/declare-functions.html">Declare functions</a></li><li><a href="category/beginner/hello-world.html">Hello world</a></li><li><a href="category/beginner/using-static-extensions.html">Using static extensions</a></li></ul></li><br/><li><a href="category/compilation/">Compilation</a><ul class="unstyled"><li><a href="category/compilation/compiling-libraries-without-main-class.html">Compiling libraries without main class</a></li></ul></li><br/><li><a href="category/data-structures/">Data structures</a><ul class="unstyled"><li><a href="category/data-structures/grid-iterator.html">Grid iterator</a></li><li><a href="category/data-structures/reverse-iterator.html">Reverse iterator</a></li><li><a href="category/data-structures/sort-array.html">Sorting arrays</a></li><li><a href="category/data-structures/step-iterator.html">Stepped iterator</a></li></ul></li><br/><li><a href="category/macros/">Macros</a><ul class="unstyled"><li><a href="category/macros/add-git-commit-hash-in-build.html">Add git commit-hash in build</a></li><li><a href="category/macros/add-parameters-as-fields.html">Add parameters as fields</a></li><li><a href="category/macros/assert-with-values.html">Assert macro that shows sub-expression values</a></li><li><a href="category/macros/build-map.html">Add a map</a></li><li><a href="category/macros/build-property-with-inline-getter.html">Add property with getter</a></li><li><a href="category/macros/build-static-field.html">Add a static field</a></li><li><a href="category/macros/build-value-objects.html">Create value-objects</a></li><li><a href="category/macros/combine-objects.html">Combine two or more structures</a></li><li><a href="category/macros/completion-from-url.html">Code completion from URL</a></li><li><a href="category/macros/enum-abstract-values.html">Get all values of an @:enum abstract</a></li><li><a href="category/macros/extract-enum-value.html">Extract values from known enum instances</a></li><li><a href="category/macros/generate-dispatch-code.html">Generate dispatch code</a></li><li><a href="category/macros/generating-code-in-a-macro.html">Generating code in a macro</a></li><li><a href="category/macros/get-compiler-define-value.html">Working with compiler flags</a></li><li><a href="category/macros/validate-json.html">Validates a .JSON file compile-time</a></li></ul></li><br/><li><a href="category/other/">Other</a><ul class="unstyled"><li><a href="category/other/adding-static-methods-to-existing-classes.html">Adding static methods to existing classes</a></li><li><a href="category/other/named-parameters.html">Named Parameters</a></li><li><a href="category/other/passing-different-types-to-a-function-parameter.html">Passing different types to a function parameter</a></li><li><a href="category/other/using-filesystem.html">Using the file system</a></li><li><a href="category/other/using-haxe-classes-in-javascript.html">Using Haxe classes in JavaScript</a></li></ul></li><br/><li><a href="category/abstract-types/">Abstract types</a><ul class="unstyled"><li><a href="category/abstract-types/emailaddress.html">EmailAddress</a></li><li><a href="category/abstract-types/rounded float.html">Rounded Float</a></li><li class="active"><a href="category/abstract-types/abstracts-with-type-params.html">Strict typing for stringly-typed extern code</a></li><li><a href="category/abstract-types/temperature-units.html">Temperature units</a></li></ul></li><br/><li><a href="category/design-patterns/">Design-patterns</a><ul class="unstyled"><li><a href="category/design-patterns/factory.html">Factory</a></li><li><a href="category/design-patterns/lazy-initialization.html">Lazy initialization</a></li><li><a href="category/design-patterns/singleton.html">Singleton</a></li></ul></li><br/><li><a href="category/principles/">Principles</a><ul class="unstyled"><li><a href="category/principles/inheritance.html">Inheritance</a></li><li><a href="category/principles/null-safety.html">Null safety</a></li><li><a href="category/principles/everything-is-an-expression.html">Everything is an expression</a></li></ul></li><br/></ul></nav><article class="span8"><h1>Strict typing for stringly-typed extern code</h1>
<p>A common pattern, often found in (but not only in) dynamic languages, is to denote the type of some object
with a string, for example:</p>
<pre><code class="prettyprint haxe">// the actual `listener` function arguments depend on the `eventName`
function addEventListener(eventName:String, listener:Function):Void;

// the returned value depends on `property`
function getProperty(property:String):Dynamic;

// the expected `value` value depends on `property`
function setProperty(property:String, value:Dynamic):Void;</code></pre>
<p>For the Haxe code, this is considered a bad pattern, since it doesn't provide compile-time type checking and thus is unsafe.
There are ways to do this safer, for example leveraging <a href="http://haxe.org/manual/types-enum-instance.html">ADT (enums)</a>,
however we often need to provide extern definitions for some code that follows this pattern.</p>
<p>Good news are - with Haxe we can stay type-safe by using type parameters and abstracts!</p>
<p>Let's examine the <code>setProperty</code> example from the code above...</p>
<h2>Step 1. Proper typing of string values</h2>
<p>Step 1 is to define a concrete type for our <code>property</code> argument, so we can't pass arbitrary string to it.
But at run-time a string is still expected, so our type should be represented as strings at run-time, which is
exactly what <a href="http://haxe.org/manual/types-abstract.html">abstract types</a> are for:</p>
<pre><code class="prettyprint haxe">abstract Property(String) {
  public inline function new(name) {
    this = name;
  }
}</code></pre>
<p>Then, let's change the <code>property</code> argument type to our new <code>Property</code> abstract type:</p>
<pre><code class="prettyprint haxe">function setProperty(property:Property, value:Dynamic):Void;</code></pre>
<p>This already provides some compile-time safety because we need to have values of the <code>Property</code> type,
not plain <code>String</code>, so we can't confuse it with other strings:</p>
<pre><code class="prettyprint haxe">var playerName = new Property("playerName"); // this could be some inlined constant

setProperty(playerName, "Dan");

// won't compile: String should be Property
// setProperty("whatever", "Dan");</code></pre>
<p>However we still can pass any value as the <code>value</code> argument, since it's typed <code>Dynamic</code>...</p>
<h2>Step 2. Binding value type to a property name</h2>
<p>We want to associate our <code>Property</code> values with a concrete type for this property value.
This is where <a href="http://haxe.org/manual/type-system-type-parameters.html">type parameters</a> come into play.</p>
<p>Let's parametrize our <code>Property</code> abstract type so its instances carry information about value type:</p>
<pre><code class="prettyprint haxe">abstract Property&lt;T&gt;(String) { // note the T type parameter
  public inline function new(name) {
    this = name;
  }
}</code></pre>
<p>Now we can create "property" values specifying types of corresponding values, like this:</p>
<pre><code class="prettyprint haxe">// the value stored in playerName is String
var playerName = new Property&lt;String&gt;("playerName");

// playerLevel values are Int
var playerLevel = new Property&lt;Int&gt;("playerLevel");

// the info property is an object with given fields
var info = new Property&lt;{age:Int, dead:Bool}&gt;("info");</code></pre>
<p>Looks descriptive, but useless until we implement step 3...</p>
<h2>Step 3. Using type parameter in a function</h2>
<p>Finally, let's make use of that type parameter <code>T</code> in our <code>setProperty</code> function.
For that we also parametrize the function and use the type parameter for the value instead of <code>Dynamic</code>:</p>
<pre><code class="prettyprint haxe">function setProperty&lt;T&gt;(property:Property&lt;T&gt;, value:T):Void;</code></pre>
<p>Note that we use the type <code>T</code> for both <code>value</code> and a type parameter for the <code>Property</code> abstract, which
ensures that they are the same.</p>
<p>Now we can call our parametrized function with properly-typed property names and get type-checking for values.</p>
<h2>Full example</h2>
<p>Here's an example of extern class for some database object that supports <code>getProperty</code> and <code>setProperty</code>:</p>
<pre><code class="prettyprint haxe">extern class Database {
  function new();
  function getProperty&lt;T&gt;(property:Property&lt;T&gt;):T;
  function setProperty&lt;T&gt;(property:Property&lt;T&gt;, value:T):Void;
}

abstract Property&lt;T&gt;(String) {
  public inline function new(name) {
    this = name;
  }
}</code></pre>
<p>And an example usage:</p>
<pre><code class="prettyprint haxe">class Main {
  static inline var PLAYER_NAME = new Property&lt;String&gt;("playerName");
  static inline var PLAYER_LEVEL = new Property&lt;Int&gt;("playerLevel");

  static function main() {
    var db = new Database();

    // playerName variable will be typed as String
    var playerName = db.getProperty(PLAYER_NAME);
    trace(playerName.toUpperCase());

    // works: expected value is Int
    db.setProperty(PLAYER_LEVEL, 1);

    // compile error: String should be Int
    // db.setProperty(PLAYER_LEVEL, "not an int");
  }
}</code></pre>
<p>Let's look at the main function compiled to JavaScript to see what it translates to:</p>
<pre><code class="prettyprint js">var db = new Database();
var playerName = db.getProperty("playerName");
console.log(playerName.toUpperCase());
db.setProperty("playerLevel",1);</code></pre>
<h2>Typed event listeners example</h2>
<p>In the beginning of this article we also mentioned the <code>addEventListener</code> function, so for the sake of completeness, let's also apply our new knowledge to it. Here, we use type parameter to specify listener function type:</p>
<pre><code class="prettyprint haxe">import haxe.Constraints.Function;

abstract Event&lt;T:Function&gt;(String) {
  public inline function new(name) {
    this = name;
  }
}

extern class EventEmitter {
  function new();
  function addEventListener&lt;T:Function&gt;(event:Event&lt;T&gt;, listener:T):Void;
}

class Main {
  static inline var EVENT_START = new Event&lt;Array&lt;String&gt;-&gt;Void&gt;("start");
  static inline var EVENT_EXIT = new Event&lt;Int-&gt;Void&gt;("exit");

  static function main() {
    var emitter = new EventEmitter();

    // arr is inferred as Array&lt;String&gt;
    emitter.addEventListener(EVENT_START, function(arr) trace(arr));

    // compile error: String -&gt; Void should be Int -&gt; Void
    // emitter.addEventListener(EVENT_EXIT, function(s:String) {});
  }
}</code></pre>
<p>Note how we also constrained our type parameter to the <code>haxe.Constraints.Function</code> which makes sure that we can only specify function types as event type parameter.</p>
<blockquote>
<p>Author: <a href="https://github.com/nadako">Dan Korostelev</a></p></blockquote><div class="tags"><hr/>Tags: <span class="tag"><i class="fa fa-tag"></i>&nbsp;<a href="tag/abstract-type.html" rel="tag">abstract-type</a></span><span class="tag"><i class="fa fa-tag"></i>&nbsp;<a href="tag/type-params.html" rel="tag">type-params</a></span><span class="tag"><i class="fa fa-tag"></i>&nbsp;<a href="tag/extern.html" rel="tag">extern</a></span></div><hr/><div class="contribution"><i class="fa fa-lightbulb-o"></i> <a href="https://github.com/HaxeFoundation/code-cookbook/edit/master/./assets/content/cookbook/Abstract types/abstracts-with-type-params.md">Suggest improvement</a> | <i class="fa fa-exclamation-circle"></i> <a href="https://github.com/HaxeFoundation/code-cookbook/issues/new?title=[Strict typing for stringly-typed extern code]&body=%0A%0ASources:%0A*%20http://code.haxe.org/category/abstract-types/abstracts-with-type-params.html%0A*%20https://github.com/HaxeFoundation/code-cookbook/tree/master/./assets/content/cookbook/Abstract types/abstracts-with-type-params.md">Report issue</a> |<i class="fa fa-plus-circle"></i> <a href="https://github.com/HaxeFoundation/code-cookbook/new/master/./assets/content/cookbook/Abstract types/snippet-name.md/?filename=snippet-name.md">Add new snippet</a></div></article></section></main></div><footer class="section dark site-footer"><div class="container"><div class="copyright"><p>&copy;2016&nbsp;<a class="hf-link" href="http://haxe.org/foundation/" title="Haxe Foundation Website">Haxe Foundation</a> |&nbsp;<a href="https://github.com/HaxeFoundation/code-cookbook" title="Haxe Code Cookbook on Github">Code Cookbook on Github</a> </p><p class="last-modified">Last modified: 16-08-2016</p></div></div></footer><link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css"/>

<link rel="stylesheet" type="text/css" href="css/haxe-nav.min.css"/><script src="http://haxe.org/js/jquery.min.js"></script><script src="http://haxe.org/js/bootstrap.min.js"></script><script src="js/highlighter.js"></script><script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-74262827-2', 'auto');  ga('send', 'pageview');</script></body></html>